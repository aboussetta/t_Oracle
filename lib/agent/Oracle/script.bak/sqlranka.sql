select /*+ ORDERED USE_NL(a c d) */
 to_char(sysdate,'YYYY/MM/DD HH24')||':00:00' TIME,
  a.SQL_ID,
  a.PLAN_HASH_VALUE,
  d.OLD_HASH_VALUE,
  d.HASH_VALUE,
  a.EXECUTIONS,
  a.DISK_READS,
  a.BUFFER_GETS,
  a.ROWS_PROCESSED,
  a.CPU_TIME,
  a.ELAPSED_TIME,
  c.COMMAND_TYPE,
  a.MODULE
from
(select /*+ ORDERED USE_NL(a b) */
 b.SQL_ID,
 b.PLAN_HASH_VALUE,
 sum(b.EXECUTIONS_DELTA) EXECUTIONS,
 sum(b.DISK_READS_DELTA) DISK_READS,
 sum(b.BUFFER_GETS_DELTA) BUFFER_GETS,
 sum(b.ROWS_PROCESSED_DELTA) ROWS_PROCESSED,
 sum(b.CPU_TIME_DELTA/1000000) "CPU_TIME",
 sum(b.ELAPSED_TIME_DELTA/1000000) "ELAPSED_TIME",  b.MODULE  from DBA_HIST_SNAPSHOT a,DBA_HIST_SQLSTAT  b where a.END_INTERVAL_TIME > sysdate - 1/24
  and a.SNAP_ID = b.SNAP_ID
group by b.SQL_ID,b.PLAN_HASH_VALUE,b.MODULE) a,DBA_HIST_SQLTEXT c,V$SQL d  where a.SQL_ID  = c.SQL_ID(+)
  and a.SQL_ID  = d.SQL_ID(+)
  and d.CHILD_NUMBER(+) = 0
